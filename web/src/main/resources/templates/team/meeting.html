<!DOCTYPE html>
<html>

<head>
  {{ > /include/header}}

  <link rel="stylesheet" type="text/css" href="/assets/css/jsCalendar.css">
  <script type="text/javascript" src="/assets/js/jsCalendar.js"></script>
  <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?clientId=wnavBrZRPufq2v2I_OdJ&submodules=geocoder"></script>
</head>

<body>
{{ > /include/navigation}}
<div class="container" style="margin-top: 20px">
  <div class="row">
    <div class="col-6">
      <div style="width: 288px">
        <div id="my-calendar"></div>
      </div>
    </div>
    <div class="col-6">
      <div id="map" style="width:100%;height:400px;"></div>
    </div>
  </div>
</div>

<div class="container schedule-card"></div>
{{ > /include/bottom}}

<script src="/assets/js/timetable.js"></script>
<script src="/assets/js/map.js"></script>
<script src="/assets/js/calendar.js"></script>
<script>
  $(document).ready(function() {
    loadScheduleInfo();
  });

  function loadScheduleInfo() {
    $.ajax({
      url: '/api/team/' + no + '/schedule/',
      method: 'get',
      dataType: 'json',
      success: function(response) {
        if (response['result'] == false) {
          alert('error');
          return;
        }

        for (var i = 0; i < response['message'].length; i++) {
          drawScheduleTable(response['message'][i]);
        }
      }
    });
  }

  function drawScheduleTable(data) {
    var date = new Date(data['date']);
    var hourSize = data['schedules'][0]['hours'].length;
    var startHour = data['schedules'][0]['hours'][0]['startHour'];
    var endHour = data['schedules'][0]['hours'][hourSize - 1]['endHour'];
    var locationName = data['location']['name'];
    var locationAddress = data['location']['address'];
    var day = data['schedules'][0]['day'];
    var title = data['title'];
    var content = data['content'];


    var template = '<div class="calendar-container" style="margin:46px;"><div class="row row-striped">\n'
        + '      <div class="col-2 text-center ">\n'
        + '        <h1 class="display-4 "><span class="badge date-green">' + date.getDate() + '월</span></h1>\n'
        + '        <h2>' + (date.getMonth() + 1) + '일</h2>\n'
        + '      </div>\n'
        + '      <div class="col-10">\n'
        + '        <h3 class="text-uppercase"><strong>' + title + '</strong></h3>\n'
        + '        <ul class="list-inline">\n'
        + '          <li class="list-inline-item"><i class="fa fa-calendar-o" aria-hidden="true"></i>' + day +  '</li>\n'
        + '          <li class="list-inline-item"><i class="fa fa-clock-o" aria-hidden="true"></i> ' + startHour + ' -  ' + endHour +  '</li>\n'
        + '          <li class="list-inline-item location-name" data-name="' + locationName + '" data-address="' + locationAddress + '"><i class="fa fa-location-arrow" aria-hidden="true"></i>' + locationName + '</li>\n'
        + '        </ul>\n'
        + '        <p>' + content + '</p>\n'
        + '      </div>\n'
        + '    </div>\n';

    $('.schedule-card').append(template);
  }

  $(document).on('click', '.location-name', function() {
    var myaddress = $(this).data('address');
    var name = $(this).data('name');

    naver.maps.Service.geocode({address: myaddress}, function(status, response) {
      var result = response.result;
      var myaddr = new naver.maps.Point(result.items[0].point.x, result.items[0].point.y);
      map.setCenter(myaddr);

      var marker = new naver.maps.Marker({
        position: myaddr,
        map: map
      });

      naver.maps.Event.addListener(marker, "click", function(e) {
        if (infowindow.getMap()) {
          infowindow.close();
        } else {
          infowindow.open(map, marker);
        }
      });

      var infowindow = new naver.maps.InfoWindow({
        content: '<h5>' + name +'</h5>'
      });

    });
  });
</script>
</body>

</html>